<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Teste Touch Mobile - Michelle</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
            color: white;
            font-family: Arial, sans-serif;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #gameContainer {
            position: relative;
            border: 2px solid gold;
            border-radius: 5px;
            background: #000;
            width: 100vw;
            height: 100vh;
            max-width: 100vw;
            max-height: 100vh;
        }
        
        #testCanvas {
            display: block;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #2d1810, #4a3426);
        }
        
        .debug-info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            max-width: 300px;
            z-index: 100;
            color: #ffd700;
            font-family: monospace;
        }
        
        .touch-indicator {
            position: absolute;
            width: 60px;
            height: 60px;
            border: 3px solid #ffd700;
            border-radius: 50%;
            background: rgba(255, 215, 0, 0.2);
            pointer-events: none;
            z-index: 50;
            display: none;
            animation: touchPulse 0.5s ease-out;
        }
        
        @keyframes touchPulse {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 0.7;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="testCanvas" width="800" height="600"></canvas>
        <div class="debug-info" id="debugInfo">
            Sistema Touch Mobile - Teste<br>
            Status: Aguardando toque...
        </div>
        <div class="touch-indicator" id="touchIndicator"></div>
    </div>

    <script>
        // Teste básico do sistema touch
        class TouchTestController {
            constructor() {
                this.canvas = document.getElementById('testCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.debugInfo = document.getElementById('debugInfo');
                this.touchIndicator = document.getElementById('touchIndicator');
                
                this.lastTouchTime = 0;
                this.doubleTapDelay = 250;
                this.touchCount = 0;
                this.moveCount = 0;
                this.interactionCount = 0;
                
                this.playerX = 400;
                this.playerY = 300;
                
                this.setupTouchEvents();
                this.startGameLoop();
                
                this.updateDebugInfo('Sistema inicializado! Toque na tela.');
            }
            
            setupTouchEvents() {
                this.canvas.addEventListener('touchstart', this.handleTouchStart.bind(this), { passive: false });
                this.canvas.addEventListener('touchend', this.handleTouchEnd.bind(this), { passive: false });
                this.canvas.addEventListener('touchmove', this.handleTouchMove.bind(this), { passive: false });
                
                // Prevenir comportamentos padrão
                this.canvas.addEventListener('contextmenu', (e) => e.preventDefault());
                document.addEventListener('gesturestart', (e) => e.preventDefault());
            }
            
            handleTouchStart(e) {
                e.preventDefault();
                this.isDragging = false;
                this.updateDebugInfo('Touch Start detectado!');
            }
            
            handleTouchMove(e) {
                e.preventDefault();
                this.isDragging = true;
            }
            
            handleTouchEnd(e) {
                e.preventDefault();
                
                if (this.isDragging) {
                    this.updateDebugInfo('Arraste ignorado');
                    return;
                }
                
                const touch = e.changedTouches[0];
                const rect = this.canvas.getBoundingClientRect();
                const scaleX = 800 / rect.width;
                const scaleY = 600 / rect.height;
                
                const touchX = (touch.clientX - rect.left) * scaleX;
                const touchY = (touch.clientY - rect.top) * scaleY;
                
                const currentTime = Date.now();
                const timeDiff = currentTime - this.lastTouchTime;
                
                this.touchCount++;
                
                // Verificar se é double tap
                if (timeDiff < this.doubleTapDelay) {
                    this.handleInteraction(touchX, touchY);
                } else {
                    // Verificar área morta central
                    const centerX = 400;
                    const centerY = 300;
                    const deadZoneRadius = 60;
                    
                    const distanceFromCenter = Math.sqrt(
                        Math.pow(touchX - centerX, 2) + Math.pow(touchY - centerY, 2)
                    );
                    
                    if (distanceFromCenter <= deadZoneRadius) {
                        this.handleInteraction(touchX, touchY);
                    } else {
                        this.handleMovement(touchX, touchY);
                    }
                }
                
                this.lastTouchTime = currentTime;
                this.showTouchIndicator(touchX, touchY);
            }
            
            handleMovement(touchX, touchY) {
                this.moveCount++;
                
                // Determinar direção
                const deltaX = touchX - this.playerX;
                const deltaY = touchY - this.playerY;
                
                let direction = '';
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    direction = deltaX > 0 ? 'direita' : 'esquerda';
                    this.playerX += deltaX > 0 ? 30 : -30;
                } else {
                    direction = deltaY > 0 ? 'baixo' : 'cima';
                    this.playerY += deltaY > 0 ? 30 : -30;
                }
                
                // Manter player nos limites
                this.playerX = Math.max(50, Math.min(750, this.playerX));
                this.playerY = Math.max(50, Math.min(550, this.playerY));
                
                this.updateDebugInfo(`MOVIMENTO para ${direction}! (${this.moveCount} movimentos)`);
            }
            
            handleInteraction(touchX, touchY) {
                this.interactionCount++;
                this.updateDebugInfo(`INTERAÇÃO executada! (${this.interactionCount} interações)`);
            }
            
            showTouchIndicator(x, y) {
                const rect = this.canvas.getBoundingClientRect();
                const visualX = (x / 800) * rect.width + rect.left;
                const visualY = (y / 600) * rect.height + rect.top;
                
                this.touchIndicator.style.left = (visualX - 30) + 'px';
                this.touchIndicator.style.top = (visualY - 30) + 'px';
                this.touchIndicator.style.display = 'block';
                
                setTimeout(() => {
                    this.touchIndicator.style.display = 'none';
                }, 500);
            }
            
            startGameLoop() {
                this.gameLoop();
            }
            
            gameLoop() {
                this.draw();
                requestAnimationFrame(() => this.gameLoop());
            }
            
            draw() {
                const ctx = this.ctx;
                
                // Limpar canvas
                ctx.fillStyle = '#2d1810';
                ctx.fillRect(0, 0, 800, 600);
                
                // Desenhar grade
                ctx.strokeStyle = '#4a3426';
                ctx.lineWidth = 1;
                for (let i = 0; i < 800; i += 50) {
                    ctx.beginPath();
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i, 600);
                    ctx.stroke();
                }
                for (let i = 0; i < 600; i += 50) {
                    ctx.beginPath();
                    ctx.moveTo(0, i);
                    ctx.lineTo(800, i);
                    ctx.stroke();
                }
                
                // Desenhar área morta central
                ctx.strokeStyle = '#ff69b4';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.arc(400, 300, 60, 0, Math.PI * 2);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Desenhar texto central
                ctx.fillStyle = '#ffd700';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ÁREA DE INTERAÇÃO', 400, 295);
                ctx.fillText('(toque aqui ou duplo toque)', 400, 310);
                
                // Desenhar player (Michelle)
                ctx.fillStyle = '#ff69b4';
                ctx.beginPath();
                ctx.arc(this.playerX, this.playerY, 15, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#ffffff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Michelle', this.playerX, this.playerY + 30);
                
                // Instruções
                ctx.fillStyle = '#ffd700';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Toque na tela para mover Michelle', 400, 50);
                ctx.fillText('Toque na área rosa ou duplo toque para interagir', 400, 70);
            }
            
            updateDebugInfo(message) {
                this.debugInfo.innerHTML = `
                    <strong>Sistema Touch Mobile - Teste</strong><br>
                    Status: ${message}<br>
                    Toques: ${this.touchCount}<br>
                    Movimentos: ${this.moveCount}<br>
                    Interações: ${this.interactionCount}<br>
                    Player: (${Math.round(this.playerX)}, ${Math.round(this.playerY)})
                `;
            }
        }
        
        // Inicializar teste
        let touchTest;
        
        document.addEventListener('DOMContentLoaded', function() {
            touchTest = new TouchTestController();
            console.log('✅ Teste Touch inicializado com sucesso');
        });
        
        // Log de erros
        window.addEventListener('error', function(e) {
            console.error('Erro:', e.error);
        });
        
        // Prevenir context menu
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>
